"use strict";(self["webpackChunkgo_shopping"]=self["webpackChunkgo_shopping"]||[]).push([[377],{3377:function(t,s,a){a.r(s),a.d(s,{default:function(){return g}});a(4114);var o=function(){var t=this,s=t._self._c;return s("div",{staticClass:"prodetail"},[s("van-nav-bar",{attrs:{fixed:"",title:"商品详情页","left-arrow":""},on:{"click-left":function(s){return t.$router.go(-1)}}}),s("van-swipe",{attrs:{autoplay:3e3},on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.images.length))])]},proxy:!0}])},t._l(t.images,(function(t,a){return s("van-swipe-item",{key:a},[s("img",{attrs:{src:t.external_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("div",{staticClass:"price"},[s("span",{staticClass:"now"},[t._v("￥"+t._s(t.goodsDetailObj.goods_price_min))]),s("span",{staticClass:"oldprice"},[t._v("￥"+t._s(t.goodsDetailObj.goods_price_max))])]),s("div",{staticClass:"sellcount"},[t._v("已售"+t._s(t.goodsDetailObj.goods_sales)+"件")])]),s("div",{staticClass:"msg text-ellipsis-2"},[t._v(" "+t._s(t.goodsDetailObj.goods_name)+" ")]),s("div",{staticClass:"service"},[s("div",{staticClass:"left-words"},[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("七天无理由退货")],1),s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("48小时发货")],1)]),s("div",{staticClass:"right-icon"},[s("van-icon",{attrs:{name:"arrow"}})],1)])]),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v("商品评价 ("+t._s(t.goodsCommentArray.length)+"条)")]),s("div",{staticClass:"right",on:{click:function(s){return t.$router.push(`/evaluation/${t.detailId}`)}}},[t._v("查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1)]),s("div",{staticClass:"comment-list"},t._l(t.goodsCommentArray,(function(a,o){return s("div",{key:a.comment_id,staticClass:"comment-item"},[o<3?s("div",{staticClass:"top"},[s("img",{attrs:{src:a.user.avatar_url?a.user.avatar_url:t.defaultAvatar,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(a.user.nick_name))]),s("van-rate",{attrs:{size:16,value:a.score,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1):t._e(),o<3?s("div",{staticClass:"content"},[t._v(" "+t._s(a.content)+" ")]):t._e(),o<3?s("div",{staticClass:"time"},[t._v(" "+t._s(a.create_time)+" ")]):t._e()])})),0)]),t._l(t.imgSrcArray,(function(t){return s("div",{key:t,staticClass:"desc"},[s("img",{attrs:{src:t,alt:""}})])})),s("div",{staticClass:"footer"},[s("div",{staticClass:"icon-home"},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",{on:{click:function(s){return t.$router.push("/home")}}},[t._v("首页")])],1),s("div",{staticClass:"icon-cart"},[s("van-icon",{attrs:{badge:t.cartTotal||"",name:"shopping-cart-o"}}),s("span",{on:{click:function(s){return t.$router.push("/cart")}}},[t._v("购物车")])],1),s("div",{staticClass:"btn-add",on:{click:t.add}},[t._v("加入购物车")]),s("div",{staticClass:"btn-buy",on:{click:t.buyNow}},[t._v("立刻购买")])]),s("van-action-sheet",{attrs:{title:"cart"===t.mode?"加入购物车":"立刻购买"},model:{value:t.showPannel,callback:function(s){t.showPannel=s},expression:"showPannel"}},[s("div",{staticClass:"product"},[s("div",{staticClass:"product-title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.goodsDetailObj.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("¥")]),s("span",{staticClass:"nowprice"},[t._v(t._s(t.goodsDetailObj.goods_price_min))])]),s("div",{staticClass:"count"},[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.goodsDetailObj.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("CountBox",{model:{value:t.addCount,callback:function(s){t.addCount=s},expression:"addCount"}})],1),t.goodsDetailObj.stock_total>0?s("div",{staticClass:"showbtn"},["cart"===this.mode?s("div",{staticClass:"btn",on:{click:t.addCart}},[t._v("加入购物车")]):s("div",{staticClass:"btn now",on:{click:t.goBuyNow}},[t._v("立刻购买")])]):s("div",{staticClass:"btn-none"},[t._v("该商品已抢完")])])])],2)},i=[],e=a(2679),n=a(3518),c=a(8009),r={name:"ProDetail",components:{CountBox:c.A},computed:{...(0,n.L8)("Cart",["countCartTotal"]),...(0,n.i0)("Cart",["getCartAction"]),detailId(){return this.$route.params.id}},async created(){const t=this.detailId,s=await(0,e._P)(t);this.goodsDetailObj=s.data.detail,this.goodsSkuId=this.goodsDetailObj.skuList[0].goods_sku_id,this.images=this.goodsDetailObj.goods_images;const a=await(0,e.dm)({scoreType:10,goodsId:t,page:1});this.goodsCommentArray=a.data.list.data;const o=this.goodsDetailObj.content,i=[],n=/<img\s+[^>]*src="([^"]*)"/g;let c;while(null!==(c=n.exec(o)))i.push(c[1]);this.imgSrcArray=i,await this.getCartAction,this.cartTotal=this.countCartTotal},data(){return{addCount:1,showPannel:!1,mode:"cart",imgSrcRegex:/<img[^>]+src="([^">]+)"/g,imgSrcArray:[],goodsDetailObj:{},goodsCommentArray:{},goodsSkuId:0,images:[],current:0,cartTotal:0,defaultAvatar:"https://ali-4rozen-oss.oss-cn-guangzhou.aliyuncs.com/coding/202408301648039.png"}},methods:{...(0,n.PY)("Address",["CLEAR_SELECTED_ADDRESS_ID"]),onChange(t){this.current=t},add(){this.showPannel=!0,this.mode="cart"},buyNow(){this.showPannel=!0,this.mode="buy"},async addCart(){this.$store.getters.token||this.$dialog.confirm({message:"当前操作需要登录后才能进行哦",confirmButtonText:"去登录",cancelButtonText:"再逛逛"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{}));const t={goodsId:this.detailId,goodsNum:this.addCount,goodsSkuId:this.goodsSkuId};this.$store.dispatch("Cart/addCartAction",t),this.cartTotal=this.countCartTotal,this.$toast("加入购物车成功！"),this.showPannel=!1},goBuyNow(){this.mode="buyNow",this.CLEAR_SELECTED_ADDRESS_ID(),this.$router.push({path:"/pay",query:{mode:this.mode,goodsId:this.detailId,goodsSkuId:this.goodsSkuId,goodsNum:this.addCount}})}},watch:{countCartTotal(t){this.cartTotal=t}}},d=r,l=a(1656),u=(0,l.A)(d,o,i,!1,null,"5d58b976",null),g=u.exports},2679:function(t,s,a){a.d(s,{_P:function(){return i},dm:function(){return e}});var o=a(5720);const i=t=>o.A.get("/goods/detail",{params:{goodsId:t}}),e=t=>{const{scoreType:s,goodsId:a,page:i}=t;return o.A.get("/comment/list",{params:{scoreType:s,goodsId:a,page:i}})}}}]);
//# sourceMappingURL=377.65d799cc.js.map