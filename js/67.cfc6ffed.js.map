{"version":3,"file":"js/67.cfc6ffed.js","mappings":"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","sources":["webpack://go-shopping/./src/views/address/index.vue","webpack://go-shopping/src/views/address/index.vue","webpack://go-shopping/./src/views/address/index.vue?12d6","webpack://go-shopping/./src/views/address/index.vue?812f"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"address-list\"},[_c('van-nav-bar',{attrs:{\"fixed\":\"\",\"title\":\"地址列表\",\"left-arrow\":\"\"},on:{\"click-left\":_vm.goWhere}}),(_vm.list.length > 0)?_c('div',[_vm._m(0),_c('van-address-list',{attrs:{\"switchable\":true,\"list\":_vm.list,\"disabled-list\":_vm.disabledList,\"disabled-text\":_vm.disabledText,\"default-tag-text\":\"默认\"},on:{\"select\":_vm.onSelect,\"add\":_vm.onAdd,\"edit\":_vm.onEdit},model:{value:(_vm.chosenAddressId),callback:function ($$v) {_vm.chosenAddressId=$$v},expression:\"chosenAddressId\"}})],1):_c('van-empty',{attrs:{\"description\":\"空空如也\"}},[_c('van-button',{staticClass:\"bottom-button\",attrs:{\"round\":\"\",\"type\":\"danger\"},on:{\"click\":_vm.onAdd}},[_vm._v(\"添加地址\")])],1)],1)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"address-list-header\"},[_c('p',{staticClass:\"header-text\"},[_vm._v(\"请选择或管理收货地址\")])])\n}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"address-list\">\r\n    <van-nav-bar fixed title=\"地址列表\" left-arrow @click-left=\"goWhere\" />\r\n    <div v-if=\"list.length > 0\">\r\n      <!-- 用于区分的文字 -->\r\n      <div class=\"address-list-header\">\r\n        <p class=\"header-text\">请选择或管理收货地址</p>\r\n      </div>\r\n\r\n      <!-- 地址列表 -->\r\n      <van-address-list\r\n        v-model=\"chosenAddressId\"\r\n        :switchable=\"true\"\r\n        :list=\"list\"\r\n        :disabled-list=\"disabledList\"\r\n        :disabled-text=\"disabledText\"\r\n        default-tag-text=\"默认\"\r\n        @select=\"onSelect\"\r\n        @add=\"onAdd\"\r\n        @edit=\"onEdit\"\r\n      />\r\n    </div>\r\n    <van-empty v-else description=\"空空如也\">\r\n      <van-button round type=\"danger\" class=\"bottom-button\" @click=\"onAdd\">添加地址</van-button>\r\n    </van-empty>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Dialog } from 'vant'\r\nimport { mapActions, mapGetters, mapMutations } from 'vuex'\r\nimport addressCTN from '@/mixins/addressCTN'\r\nimport { getAddressList, getDefaultAddressId, getAddressDetail, setDefaultAddress } from '@/api/address'\r\nimport addressHandler from '@/mixins/addressHandler'\r\n\r\nexport default {\r\n  name: 'AddressList',\r\n  mixins: [addressCTN, addressHandler],\r\n  data () {\r\n    return {\r\n      // 中间变量，用于暂时存放默认地址id\r\n      zeroId: 0,\r\n      // 默认选中的地址id\r\n      chosenAddressId: 0,\r\n      // 地址列表\r\n      list: [],\r\n      // 禁用状态的地址列表（超出快递范围）\r\n      disabledList: []\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters('Address', ['getDefaultAddressId']),\r\n    disabledText () {\r\n      return this.disabledList.length > 0 ? '以下地址超出配送范围' : ''\r\n    }\r\n  },\r\n  async created () {\r\n    await this.doLoad()\r\n  },\r\n  methods: {\r\n    ...mapActions('Address', ['getAddressList']),\r\n    ...mapMutations('Address', ['SET_ADDRESS_ID', 'SET_SELECTED_ADDRESS_ID']),\r\n    // 得到地址列表\r\n    async myAdressList () {\r\n      const { data: { list } } = await getAddressList()\r\n      return list\r\n    },\r\n    // 格式化从后端得到的数据，将其符合vant的Address数据结构\r\n    formatStructure (item) {\r\n      // 改变item对象的键名\r\n      item.id = item.address_id\r\n      item.tel = item.phone\r\n      item.address = item.region + ' ' + item.detail\r\n\r\n      // 删除旧的键名\r\n      delete item.address_id\r\n      delete item.phone\r\n      delete item.region\r\n      delete item.detail\r\n    },\r\n    // 得到默认地址id\r\n    async myDefaultAddressId () {\r\n      const defaultAddressId = await getDefaultAddressId()\r\n      return defaultAddressId\r\n    },\r\n    // 设置默认地址\r\n    async setDefaultAddress (addressId) {\r\n      await setDefaultAddress(addressId)\r\n    },\r\n    // 得到地址详情\r\n    async myAddressDetail (addressId) {\r\n      const { data: { detail } } = await getAddressDetail(addressId)\r\n      return detail\r\n    },\r\n    async onSelect (item) {\r\n      console.log('选中了item：', item)\r\n      // this.$router.replace(`/pay?adsid=${item.id}`)\r\n      Dialog.alert({\r\n        title: '选择确认',\r\n        message: '您确定选择这个地址为默认地址吗？\\n收货地址为默认地址哦',\r\n        showCancelButton: true\r\n      }).then(() => {\r\n        // on close\r\n        // 设置选中地址id\r\n        this.SET_SELECTED_ADDRESS_ID(item.id)\r\n        this.setDefaultAddress(item.id)\r\n        // 设置完成后重新拉取地址列表\r\n        this.doLoad()\r\n      }).catch(() => {\r\n        // 点击取消后将chosenAddressId赋值为默认地址id\r\n        this.chosenAddressId = this.zeroId\r\n      })\r\n    },\r\n    onAdd () {\r\n      this.$router.replace({\r\n        name: 'AddressE',\r\n        query: {\r\n          ...this.$route.query\r\n        }\r\n      })\r\n    },\r\n    onEdit (item) {\r\n      // 设置要进行传递的地址id\r\n      this.SET_ADDRESS_ID(item.id)\r\n      console.log('跳转到编辑：', item)\r\n      this.$router.replace({\r\n        name: 'AddressE',\r\n        query: {\r\n          ...this.$route.query\r\n        }\r\n      })\r\n    },\r\n    async doLoad () {\r\n    // console.log(this.getFrom)\r\n    // 获取默认地址id\r\n      try {\r\n        const res = await this.myDefaultAddressId() // 获取默认地址id\r\n        this.chosenAddressId = res.data.defaultId\r\n        this.zeroId = this.chosenAddressId\r\n        console.log('拉取默认地址id：', this.chosenAddressId)\r\n      } catch (error) {\r\n        // 失败说明没有默认地址\r\n        this.chosenAddressId = this.list[0].id\r\n        console.log('获取默认地址id失败：', error)\r\n      }\r\n\r\n      // 获取地址列表\r\n      try {\r\n        this.list = await this.myAdressList()\r\n        // console.log('首次拉取到的this.list:', this.list)\r\n        // 没有默认地址则给this.list的每一个对象添加isDefault属性，值为false\r\n        this.list.forEach(item => {\r\n          item.isDefault = false\r\n        })\r\n        // 给默认地址添加isDefault属性，值为true\r\n        this.list.forEach(item => {\r\n          // console.log('kkitem:', item)\r\n          if (Number(item.address_id) === Number(this.chosenAddressId)) {\r\n            // console.log('找到默认地址：', item)\r\n            item.isDefault = true\r\n          }\r\n        })\r\n        // console.log('根据是否有默认地址，给this.list添加isDefault属性后的this.list：', this.list)\r\n        // 格式化地区信息，通过Code得到Name\r\n        this.list.forEach(item => {\r\n          item.region = this.getRegionStrByCode(this.getRegionCode(item.province_id, item.city_id, item.region_id))\r\n        })\r\n        // 格式化list，使其中的键名符合vant的Address数据结构，便于渲染展示\r\n        this.list.forEach(item => {\r\n          item = this.formatStructure(item)\r\n          // console.log('item:', item)\r\n        })\r\n      } catch (error) {\r\n        this.list = []\r\n        console.log('获取地址列表失败：', error)\r\n      }\r\n    },\r\n    goWhere () {\r\n      // console.log('params:', this.$route.params.whoami)\r\n      // 判断有没有传参数\r\n      if (this.getFrom) {\r\n        if (this.getFrom === 'pay') {\r\n          console.log('跳转到支付页面')\r\n          this.$router.replace({\r\n            name: 'Pay',\r\n            query: {\r\n              ...this.$route.query\r\n            }\r\n          })\r\n        } else if (this.getFrom === 'I') {\r\n          // 未来添加返回个人页面\r\n          // this.$router.replace({\r\n          //   name: 'Cart',\r\n          //   query: {\r\n          //     ...this.$route.query\r\n          //   }\r\n          // })\r\n        }\r\n      } else {\r\n        this.$router.go(-1)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.custom-nav-bar {\r\n  background-color: #ffffff; // 导航栏背景色\r\n  height: 50px; // 设置导航栏的高度\r\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); // 添加阴影效果\r\n}\r\n\r\n.address-list {\r\n  padding-top: 60px; // 增加顶部内边距，以避免内容被导航栏遮挡\r\n}\r\n\r\n.address-list-header {\r\n  padding: 10px 16px;\r\n  background-color: #f8f8f8;\r\n}\r\n\r\n.header-text {\r\n  font-size: 16px;\r\n  color: #333;\r\n  text-align: left;\r\n  margin: 0;\r\n}\r\n\r\n/* 地址列表项样式 */\r\n.van-address-list__item {\r\n  margin-bottom: 10px; // 每一项之间的间距\r\n  padding: 10px 16px; // 内边距，使内容不贴边\r\n  border: 1px solid #ddd; // 边框颜色\r\n  border-radius: 4px; // 圆角边框\r\n  background-color: #fff; // 背景色\r\n\r\n  .van-cell__title, .van-cell__label {\r\n    white-space: normal; // 允许内容换行\r\n    word-wrap: break-word; // 自动换行\r\n    word-break: break-all; // 长单词换行\r\n  }\r\n}\r\n\r\n/* 禁用状态的地址项样式 */\r\n.van-address-list__item--disabled {\r\n  background-color: #f5f5f5; // 禁用项的背景色\r\n  color: #999; // 禁用项的文字颜色\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=e06a0ea8&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=e06a0ea8&prod&scoped=true&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"e06a0ea8\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","goWhere","list","length","_m","disabledList","disabledText","onSelect","onAdd","onEdit","model","value","chosenAddressId","callback","$$v","expression","_v","staticRenderFns","name","mixins","addressCTN","addressHandler","data","zeroId","computed","mapGetters","created","doLoad","methods","mapActions","mapMutations","myAdressList","getAddressList","formatStructure","item","id","address_id","tel","phone","address","region","detail","myDefaultAddressId","defaultAddressId","getDefaultAddressId","setDefaultAddress","addressId","myAddressDetail","getAddressDetail","console","log","_Dialog","alert","title","message","showCancelButton","then","SET_SELECTED_ADDRESS_ID","catch","$router","replace","query","$route","SET_ADDRESS_ID","res","defaultId","error","forEach","isDefault","Number","getRegionStrByCode","getRegionCode","province_id","city_id","region_id","getFrom","go","component"],"sourceRoot":""}