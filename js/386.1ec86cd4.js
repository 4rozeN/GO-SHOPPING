"use strict";(self["webpackChunkgo_shopping"]=self["webpackChunkgo_shopping"]||[]).push([[386],{1386:function(t,e,r){r.r(e),r.d(e,{default:function(){return u}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-review"},[e("van-nav-bar",{staticStyle:{"background-color":"#f8f8f8","box-shadow":"0 2px 5px rgba(0, 0, 0, 0.1)"},attrs:{fixed:"",title:"订单评价","left-arrow":"","right-text":t.rightButtonText},on:{"click-left":t.onLeftClick,"click-right":t.onRightClick}}),e("div",{staticClass:"content"},[e("van-card",{staticClass:"goods-card",attrs:{num:t.currentGoods.total_num,price:t.currentGoods.total_pay_price,title:t.currentGoods.goods_name,thumb:t.currentGoods.goods_image}},[e("div",{staticClass:"review-section",attrs:{slot:"footer"},slot:"footer"},[e("div",{staticClass:"rating-section"},[e("div",{staticClass:"section-title"},[t._v("商品评价")]),e("van-rate",{model:{value:t.currentGoods.rating,callback:function(e){t.$set(t.currentGoods,"rating",e)},expression:"currentGoods.rating"}})],1),e("div",{staticClass:"comment-section"},[e("div",{staticClass:"section-title"},[t._v("评价内容:")]),e("van-field",{staticClass:"comment-field",attrs:{placeholder:"写下你的评价...",type:"textarea",rows:"6",autosize:"",maxlength:"200","show-word-limit":"",clearable:""},model:{value:t.currentGoods.comment,callback:function(e){t.$set(t.currentGoods,"comment",e)},expression:"currentGoods.comment"}})],1),e("input",{attrs:{type:"file"},on:{change:t.onImageChange}}),t.currentGoods.images.length?e("div",t._l(t.currentGoods.images,(function(t,r){return e("div",{key:r},[e("img",{staticStyle:{"max-width":"100%",height:"auto"},attrs:{src:t,alt:"Uploaded Image"}})])})),0):t._e()])])],1),e("van-button",{staticClass:"submit-button",attrs:{type:"primary",block:""},on:{click:t.saveDraft}},[t._v(" 保存草稿 ")])],1)},s=[],n=(r(4114),r(4180)),i={name:"OrderReview",data(){return{goods:[],currentIndex:0}},computed:{getOrderId(){return this.$route.query.orderId},currentGoods(){return this.goods[this.currentIndex]||{images:[]}},rightButtonText(){return this.isLastItem?"提交":"下一件"},isLastItem(){return this.currentIndex===this.goods.length-1}},async created(){const t=await(0,n.KU)(this.getOrderId),e=this.loadDraft();this.goods=t.data.order.goods.map((t=>({...t,rating:e[t.goods_id]?.rating||0,comment:e[t.goods_id]?.comment||"",images:[]})))},methods:{onLeftClick(){0===this.currentIndex?this.$router.go(-1):this.currentIndex-=1},onRightClick(){this.isLastItem?this.submitReview():this.currentIndex+=1},onImageChange(t){const e=t.target.files;if(e.length){const t=e[0],r=new FileReader;r.onloadend=()=>{this.currentGoods.images.push(r.result)},r.readAsDataURL(t)}},saveDraft(){const t=this.goods.reduce(((t,e)=>(t[e.goods_id]={rating:e.rating,comment:e.comment},t)),{});localStorage.setItem(`order_${this.getOrderId}_draft`,JSON.stringify(t)),this.$toast.success("草稿已保存")},loadDraft(){const t=localStorage.getItem(`order_${this.getOrderId}_draft`);return t?JSON.parse(t):{}},async submitReview(){try{const t={};t.orderId=this.getOrderId,t.form=[],this.goods.forEach((e=>{const r={};r.goods_id=e.goods_id,r.order_id=e.order_id,r.score=e.rating,r.content=e.comment,r.imageList=e.images.map((t=>t.url)),r.uploaded=!0,t.form.push(r)})),await(0,n.cC)(t),this.$toast.success("评价提交成功"),this.$router.go(-1),localStorage.removeItem(`order_${this.getOrderId}_draft`)}catch(t){this.$toast.fail(t),console.error(t)}}}},a=i,d=r(1656),c=(0,d.A)(a,o,s,!1,null,"395666e4",null),u=c.exports},4180:function(t,e,r){r.d(e,{Fs:function(){return s},KU:function(){return a},N4:function(){return d},Nj:function(){return i},Z7:function(){return n},cC:function(){return u},l2:function(){return c}});var o=r(5720);const s=(t,e)=>{const r={mode:t,delivery:10,shopId:0,couponId:0,isUserPoints:0,...e};return o.A.get("/checkout/order",{params:r})},n=(t,e)=>{const r={mode:t,delivery:10,couponId:0,isUserPoints:0,payType:10,...e};return o.A.post("/checkout/submit",r)},i=(t,e)=>o.A.get("/order/list",{params:{dataType:t,page:e}}),a=t=>o.A.get("/order/detail",{params:{orderId:t}}),d=t=>o.A.post("/order/cancel",{orderId:t}),c=t=>o.A.post("/order/receipt",{orderId:t}),u=t=>o.A.post("/order.comment/submit",{orderId:t.orderId,form:t.form})}}]);
//# sourceMappingURL=386.1ec86cd4.js.map