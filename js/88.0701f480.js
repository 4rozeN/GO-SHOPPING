"use strict";(self["webpackChunkgo_shopping"]=self["webpackChunkgo_shopping"]||[]).push([[88],{88:function(s,t,e){e.r(t),e.d(t,{default:function(){return p}});var o=function(){var s=this,t=s._self._c;return t("div",{staticClass:"pay"},[t("van-nav-bar",{attrs:{fixed:"",title:"订单结算台","left-arrow":""},on:{"click-left":function(t){return s.$router.go(-1)}}}),t("div",{staticClass:"address"},[t("div",{staticClass:"left-icon"},[t("van-icon",{attrs:{name:"logistics"}})],1),s.chosenAddress?t("div",{staticClass:"info"},[t("div",{staticClass:"info-content"},[t("span",{staticClass:"name"},[s._v(s._s(s.chosenAddress.name)+" ")]),t("span",{staticClass:"mobile"},[s._v(s._s(s.chosenAddress.phone))])]),t("div",{staticClass:"info-address"},[s._v(" "+s._s(s.chosenAddress.detail)+" ")])]):t("div",{staticClass:"info"},[s._v(" 还没有地址哦，点击右侧按钮添加吧 ")]),t("div",{staticClass:"right-icon",on:{click:s.goAddress}},[t("van-icon",{attrs:{name:"arrow"}})],1)]),t("div",{staticClass:"pay-list"},[t("div",{staticClass:"list"},s._l(s.goodsList,(function(e){return t("div",{key:e.goods_id,staticClass:"goods-item"},[t("div",{staticClass:"left"},[t("img",{attrs:{src:e.goods_image,alt:""}})]),t("div",{staticClass:"right"},[t("p",{staticClass:"tit text-ellipsis-2"},[s._v(" "+s._s(e.goods_name)+" ")]),t("p",{staticClass:"info"},[t("span",{staticClass:"count"},[s._v("共"+s._s(e.total_num)+"件")]),t("span",{staticClass:"price"},[s._v("¥"+s._s(e.total_price))])])])])})),0),t("div",{staticClass:"flow-num-box"},[t("span",[s._v("共 "+s._s(s.goodsNumCount)+" 件商品，合计：")]),t("span",{staticClass:"money"},[s._v("￥"+s._s(s.goodsTotalPrice))])]),t("div",{staticClass:"pay-detail"},[t("div",{staticClass:"pay-cell"},[t("span",[s._v("订单总金额：")]),t("span",{staticClass:"red"},[s._v("￥"+s._s(s.goodsTotalPrice))])]),t("div",{staticClass:"pay-cell"},[t("span",[s._v("优惠券：")]),t("span",[s._v(s._s(s.personal.couponId?"优惠券可用":"无优惠券可用"))])]),t("div",{staticClass:"pay-cell"},[t("span",[s._v("配送费用：")]),t("span",{staticClass:"red"},[s._v("+￥0.00")])])]),t("div",{staticClass:"pay-way"},[t("span",{staticClass:"tit"},[s._v("支付方式")]),t("div",{staticClass:"pay-cell"},[t("span",[t("van-icon",{attrs:{name:"balance-o"}}),s._v("余额支付（可用 ¥ "+s._s(s.personal.balance)+" 元）")],1),t("span",{staticClass:"red"},[t("van-icon",{attrs:{name:"passed"}})],1)])]),t("div",{staticClass:"buytips"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:s.remark,expression:"remark"}],attrs:{placeholder:"选填：买家留言（50字内）",name:"",id:"",cols:"30",rows:"10"},domProps:{value:s.remark},on:{input:function(t){t.target.composing||(s.remark=t.target.value)}}})])]),t("div",{staticClass:"footer-fixed"},[t("div",{staticClass:"left"},[s._v("实付款："),t("span",[s._v("￥"+s._s(s.goodsTotalPrice))])]),t("div",{staticClass:"tipsbtn",on:{click:s.orderConfirm}},[s._v("提交订单")])])],1)},a=[],i=(e(4114),e(4959)),d=e(4776),r=e(3518),n=e(4180),c=e(2776),l={name:"PayIndex",mixins:[i.A,d.A],async created(){try{const{data:{defaultId:s}}=await this.myDefaultAddressId()||0;this.myDefaultId=s,console.log("defaultId:",s)}catch(s){this.myDefaultId=0,console.log("没有默认地址Id",s)}if(await this.myAddressList(),0===this.addressList.length)this.chosenAddress=0,console.log("没有地址存在，啥也干不了");else if(this.myDefaultId){const s=await this.myAddressDetail(Number(this.myDefaultId));console.log("地址res:",s),s.detail=this.getRegionStrByCode(this.getRegionCode(s.province_id,s.city_id,s.region_id))+" "+s.detail,this.chosenAddress=s,console.log("有默认地址，地址详情res：",s),console.log("格式化后的地址：",this.chosenAddress)}else{const s=await this.myAddressListZero();s.detail=this.getRegionStrByCode(this.getRegionCode(s.province_id,s.city_id,s.region_id))+" "+s.detail,this.chosenAddress=s,console.log("没有默认地址，展示第一个地址：",s),console.log("格式化后的地址：",this.chosenAddress)}try{await this.getOrderList()}catch(s){console.log("提交订单失败",s)}},data(){return{myDefaultId:0,remark:"",chosenAddress:{},addressList:[],goodsList:[],personal:{},setting:{}}},computed:{goodsTotalPrice(){let s=0;return this.goodsList.forEach((t=>{s+=Number(t.goods_price_min)*t.total_num})),s.toFixed(2)},goodsNumCount(){let s=0;return this.goodsList.forEach((t=>{s+=t.total_num})),s},selectedA(){return this.chosenAddress},cartIds(){return this.$route.query.cartIds},getadsid(){return this.$route.params.adsid},getModeType(){return this.$route.query.mode},goodsId(){return this.$route.query.goodsId},goodsSkuId(){return this.$route.query.goodsSkuId},goodsNum(){return this.$route.query.goodsNum}},methods:{...(0,r.PY)("Address",["CLEAR_SELECTED_ADDRESS_ID"]),...(0,r.i0)("Address",["getAddressList"]),...(0,r.L8)("Address",["getDefaultAddressId","getSelection"]),...(0,r.i0)("Cart",["getCartAction"]),...(0,r.L8)("Cart",["selectedCartList","selectedCartCount","selectedPrice"]),...(0,r.L8)("Order",["getMode","getCartIds"]),async myAddressList(){const{data:{list:s}}=await(0,c.Re)();this.addressList=s,console.log("地址列表:",this.addressList)},async myDefaultAddressId(){const s=await(0,c.nF)();return s},async myAddressListZero(){const{data:{list:s}}=await(0,c.Re)();return s[0]},async myAddressDetail(s){const{data:{detail:t}}=await(0,c.Yx)(s);return t},goAddress(){this.$router.push({path:"/address/manage",query:{...this.$route.query},params:{whoami:"pay"}})},async getOrderList(){if("cart"===this.getModeType){const{data:s}=await(0,n.Fs)(this.getModeType,{cartIds:this.cartIds});this.goodsList=s.order.goodsList,this.personal=s.personal,this.setting=s.setting}if("buyNow"===this.getModeType){const{data:s}=await(0,n.Fs)(this.getModeType,{goodsId:this.goodsId,goodsNum:this.goodsNum,goodsSkuId:this.goodsSkuId});this.goodsList=s.order.goodsList,this.personal=s.personal,this.setting=s.setting}},async orderConfirm(){if("cart"===this.getModeType){const{data:s}=await(0,n.Z7)(this.getModeType,{cartIds:this.cartIds,remark:this.remark});console.log("cart提交订单成功",s)}if("buyNow"===this.getModeType){const{data:s}=await(0,n.Fs)(this.getModeType,{remark:this.remark,goodsId:this.goodsId,goodsNum:this.goodsNum,goodsSkuId:this.goodsSkuId});console.log("buyNow提交订单成功",s)}this.$router.replace("/myorder")}}},u=l,g=e(1656),h=(0,g.A)(u,o,a,!1,null,"ddcd7dc6",null),p=h.exports},4180:function(s,t,e){e.d(t,{Fs:function(){return a},KU:function(){return r},N4:function(){return n},Nj:function(){return d},Z7:function(){return i},cC:function(){return l},l2:function(){return c}});var o=e(5720);const a=(s,t)=>{const e={mode:s,delivery:10,shopId:0,couponId:0,isUserPoints:0,...t};return o.A.get("/checkout/order",{params:e})},i=(s,t)=>{const e={mode:s,delivery:10,couponId:0,isUserPoints:0,payType:10,...t};return o.A.post("/checkout/submit",e)},d=(s,t)=>o.A.get("/order/list",{params:{dataType:s,page:t}}),r=s=>o.A.get("/order/detail",{params:{orderId:s}}),n=s=>o.A.post("/order/cancel",{orderId:s}),c=s=>o.A.post("/order/receipt",{orderId:s}),l=s=>o.A.post("/order.comment/submit",{orderId:s.orderId,form:s.form})}}]);
//# sourceMappingURL=88.0701f480.js.map